---
---

<button 
  id="theme-toggle" 
  data-theme-toggle
  class="relative overflow-hidden rounded-full p-1.5 sm:p-2 transition-all duration-300 hover:bg-zinc-100 dark:hover:bg-zinc-800 focus:outline-none focus:ring-2 focus:ring-zinc-300 dark:focus:ring-zinc-700 group touch-manipulation"
  aria-label="Toggle dark mode"
>
  <div class="relative z-10 flex h-5 w-5 items-center justify-center">
    <!-- Sun icon -->
    <svg 
      xmlns="http://www.w3.org/2000/svg" 
      class="icon-light absolute h-5 w-5 rotate-0 scale-100 transition-all duration-500 dark:-rotate-90 dark:scale-0 text-zinc-800 dark:text-zinc-200"
      viewBox="0 0 24 24" 
      fill="none" 
      stroke="currentColor" 
      stroke-width="2" 
      stroke-linecap="round" 
      stroke-linejoin="round"
    >
      <circle cx="12" cy="12" r="5"/>
      <path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/>
    </svg>
    
    <!-- Moon icon -->
    <svg 
      xmlns="http://www.w3.org/2000/svg" 
      class="icon-dark absolute h-5 w-5 rotate-90 scale-0 transition-all duration-500 dark:rotate-0 dark:scale-100 text-zinc-800 dark:text-zinc-200"
      viewBox="0 0 24 24" 
      fill="none" 
      stroke="currentColor" 
      stroke-width="2" 
      stroke-linecap="round" 
      stroke-linejoin="round"
    >
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </div>
  
  <!-- Ripple effect -->
  <span class="absolute inset-0 h-full w-full bg-zinc-200 dark:bg-zinc-700 opacity-0 transition-opacity duration-300 group-active:opacity-20"></span>
</button>

<script>
  // Optimized theme toggle with essential features only
  function setupThemeToggle() {
    // Check system preference and saved preference
    const prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const savedTheme = localStorage.getItem('theme');
    const currentTheme = savedTheme || (prefersDarkMode ? 'dark' : 'light');
    
    // Apply initial theme
    document.documentElement.classList.toggle('dark', currentTheme === 'dark');
    
    // Handle theme toggle clicks
    document.querySelectorAll('[data-theme-toggle]').forEach(toggle => {
      toggle.addEventListener('click', () => {
        const isDark = document.documentElement.classList.contains('dark');
        const newTheme = isDark ? 'light' : 'dark';
        
        // Toggle theme
        document.documentElement.classList.toggle('dark', newTheme === 'dark');
        
        // Save preference
        localStorage.setItem('theme', newTheme);
        
        // Dispatch event for other components
        document.dispatchEvent(new CustomEvent('themeChanged', { 
          detail: { isDark: newTheme === 'dark' } 
        }));
      });
    });
  }
  
  // Initialize on DOM load
  document.addEventListener('DOMContentLoaded', setupThemeToggle);
  
  // Listen for system preference changes
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', ({ matches }) => {
    if (!localStorage.getItem('theme')) {
      document.documentElement.classList.toggle('dark', matches);
    }
  });
</script>

<style>
  /* Smooth transition for the entire page when theme changes */
  :global(body) {
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  
  /* Subtle hover animation */
  #theme-toggle {
    transform: translateY(0);
    box-shadow: 0 0 0 rgba(0, 0, 0, 0);
    -webkit-tap-highlight-color: transparent; /* Remove default mobile tap highlight */
    min-height: 32px; /* Ensure minimum touch target size */
    min-width: 32px; /* Ensure minimum touch target size */
  }
  
  /* Only apply hover effects on non-touch devices */
  @media (hover: hover) {
    #theme-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    #theme-toggle:hover .icon-light:not(.dark .icon-light) {
      filter: drop-shadow(0 0 2px rgba(251, 191, 36, 0.6));
      transform: scale(1.1) rotate(15deg);
    }
    
    #theme-toggle:hover .icon-dark:not(:not(.dark) .icon-dark) {
      filter: drop-shadow(0 0 2px rgba(129, 140, 248, 0.6));
      transform: scale(1.1) rotate(-15deg);
    }
  }
  
  /* Optimize animations for mobile */
  @media (prefers-reduced-motion: reduce) {
    .icon-light, .icon-dark {
      transition: all 0.2s ease-out !important;
    }
    
    #theme-toggle, #theme-toggle:hover {
      transform: none;
      transition: none;
    }
  }
  
  /* Adjust size for very small screens */
  @media (max-width: 320px) {
    #theme-toggle {
      padding: 0.25rem !important;
    }
  }
</style>

